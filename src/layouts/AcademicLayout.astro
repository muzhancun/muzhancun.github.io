---
import { ThemeProvider, Footer } from 'astro-pure/components/basic'
import type { SiteMeta } from 'astro-pure/types'
import BaseHead from '@/components/BaseHead.astro'
import config from '@/site-config'

// Import global styles
import '@/assets/styles/app.css'
// Import academic fonts
import '@fontsource/merriweather'
import '@fontsource/merriweather/400-italic.css'
import '@fontsource/merriweather/700.css'
import '@fontsource/merriweather/900.css'
import '@fontsource/inter'

interface Props {
  meta: SiteMeta
  highlightColor?: string
  backLink?: { label: string; href: string }
}

const {
  meta: { articleDate, description = config.description, ogImage, title },
  highlightColor,
  backLink,
  ...props
} = Astro.props
---

<html lang={config.locale.lang}>
  <head>
    <BaseHead {articleDate} {description} {ogImage} {title} />
    <ThemeProvider />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  </head>

  <body class='bg-background text-foreground antialiased' {...props}>
    {
      highlightColor && (
        <div
          id='highlight-gradient'
          class='pointer-events-none absolute start-0 top-0 z-0 h-screen w-full opacity-10'
          style={`background-image:linear-gradient(to bottom, ${highlightColor}, transparent)`}
        />
      )
    }
    
    <div class='mx-auto max-w-[800px] px-6 min-h-[100dvh] flex flex-col'>
      {/* Minimal Header / Breadcrumb */}
      <header class='py-8 flex items-center justify-between text-sm text-muted-foreground'>
        <nav class="flex items-center gap-2">
           <a href="/" class="hover:text-foreground transition-colors font-medium">Home</a>
           <span>/</span>
           <a href="/preprints" class="hover:text-foreground transition-colors font-medium">Preprints</a>
           {/* We could add current title here but it might be too long */}
        </nav>
        
        {/* Toggle Dark Mode Button (Minimal) */}
         <button
          id='toggleDarkMode'
          class='p-2 hover:text-foreground transition-colors'
          aria-label="Toggle dark mode"
        >
           <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun dark:hidden"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41-1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
           <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon hidden dark:block"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
        </button>
      </header>

      <main class="flex-1 w-full animate-fade-in">
        <slot />
      </main>

      <div class="py-12 text-center text-sm text-muted-foreground border-t border-dashed border-border/40 mt-12">
         &copy; {new Date().getFullYear()} {config.author}. All rights reserved.
      </div>
    </div>
    
    <script>
      const toggleBtn = document.getElementById('toggleDarkMode')
      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          const isDark = document.documentElement.classList.toggle('dark')
          localStorage.setItem('theme', isDark ? 'dark' : 'light')
          // Force update for any other listeners
          window.dispatchEvent(new Event('storage'))
        })
      }
    </script>
  </body>
</html>
